<ls:UIWidget xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:System="clr-namespace:System;assembly=mscorlib"
             xmlns:noesis="clr-namespace:NoesisGUIExtensions;assembly=Noesis.GUI.Extensions"
             xmlns:ls="clr-namespace:ls;assembly=Code"
             Template="{StaticResource Hud.Root}"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             x:Name="CursorText"
             ContextName="CursorText"
             d:DataContext="{d:DesignInstance Type=ls:DCCursorText}">
    <Control  >
        <Control.Template>
            <ControlTemplate >
                <ControlTemplate.Resources>
                    <Thickness x:Key="TooltipMargin" >-40,0,-40,-32</Thickness>

                    <DropShadowEffect x:Key="DropShadow" Direction="270" Color="{StaticResource LS_PrimaryColorDropShadowColor}" ShadowDepth="3.0" BlurRadius="5.0"/>

                    <Style x:Key="CursorTextStyle" TargetType="{x:Type TextBlock}">
                        <Setter Property="FontSize" Value="{StaticResource ScaledBigFontSize}"/>
                        <Setter Property="Foreground" Value="{StaticResource LS_tint100}"/>
                        <Setter Property="Visibility" Value="Visible"/>
                        <Setter Property="noesis:Text.Stroke" Value="Black"/>
                        <Setter Property="noesis:Text.StrokeThickness" Value="4"/>
                        <Setter Property="Effect" Value="{StaticResource DropShadow}"/>
                        <Style.Triggers>
                            <Trigger Property="Text" Value="">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>

                    <Style x:Key="CollapsedNameStyle" TargetType="{x:Type TextBlock}" BasedOn="{StaticResource CursorTextStyle}">
                        <Setter Property="Foreground" Value="{StaticResource LS_accent25TxtColor}"/>
                        <Setter Property="FontSize" Value="{StaticResource ScaledSmallFontSize}"/>
                        <Setter Property="HorizontalAlignment" Value="Left"/>
                    </Style>

                    <Style x:Key="CursorErrorTextStyle" TargetType="{x:Type TextBlock}" BasedOn="{StaticResource CursorTextStyle}">
                        <Setter Property="FontSize" Value="{StaticResource ScaledSmallishFontSize}"/>
                    </Style>

                    <Style x:Key="ModifierTextBlockStatus" TargetType="TextBlock">
                        <Setter Property="FontSize" Value="{StaticResource ScaledMediumFontSize}"/>
                        <Setter Property="Foreground" Value="Yellow"/>
                        <Setter Property="noesis:Text.Stroke" Value="Black"/>
                        <Setter Property="noesis:Text.StrokeThickness" Value="4"/>
                        <Setter Property="Effect" Value="{StaticResource DropShadow}"/>
                    </Style>

                    <DataTemplate x:Key="StatusItemTemplate" DataType="ls:VMAdvantage">
                        <StackPanel  Orientation="Horizontal">
                            <TextBlock x:Name="cStatusDisplay" Style="{StaticResource ModifierTextBlockStatus}" Text="{Binding Description}" Visibility="Collapsed"/>
                            <TextBlock x:Name="cStatusDisplayHidden" Style="{StaticResource ModifierTextBlockStatus}" Foreground="DarkOrange" Text="{Binding Description}" Visibility="Collapsed"/>
                            <TextBlock x:Name="cHiddenChance" Style="{StaticResource ModifierTextBlockStatus}" Foreground="DarkOrange" Text=" (50%) " Visibility="Collapsed"/>
                            <TextBlock x:Name="cConcealedChance" Style="{StaticResource ModifierTextBlockStatus}" Text=" (80%) " Visibility="Collapsed"/>
                            <TextBlock x:Name="cDazzledChance" Style="{StaticResource ModifierTextBlockStatus}" Text=" (80%) " Visibility="Collapsed"/>
                            <TextBlock x:Name="cStupefied1Chance" Style="{StaticResource ModifierTextBlockStatus}" Text=" (75%) " Visibility="Collapsed"/>
                            <TextBlock x:Name="cStupefied2Chance" Style="{StaticResource ModifierTextBlockStatus}" Text=" (70%) " Visibility="Collapsed"/>
                            <TextBlock x:Name="cStupefied3Chance" Style="{StaticResource ModifierTextBlockStatus}" Text=" (65%) " Visibility="Collapsed"/>
                            <TextBlock x:Name="cStupefied4Chance" Style="{StaticResource ModifierTextBlockStatus}" Text=" (60%) " Visibility="Collapsed"/>
                        </StackPanel>
                        <DataTemplate.Triggers>
                            <DataTrigger Binding="{Binding Description, Converter={StaticResource CompareStringConverter}, ConverterParameter='Hidden'}" Value="True">
                                <Setter TargetName="cStatusDisplayHidden" Property="Visibility" Value="Visible" />
                                <Setter TargetName="cHiddenChance" Property="Visibility" Value="Visible" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Description, Converter={StaticResource CompareStringConverter}, ConverterParameter='Concealed'}" Value="True">
                                <Setter TargetName="cStatusDisplay" Property="Visibility" Value="Visible" />
                                <Setter TargetName="cConcealedChance" Property="Visibility" Value="Visible" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Description, Converter={StaticResource CompareStringConverter}, ConverterParameter='Dazzled'}" Value="True">
                                <Setter TargetName="cStatusDisplay" Property="Visibility" Value="Visible" />
                                <Setter TargetName="cDazzledChance" Property="Visibility" Value="Visible" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Description, Converter={StaticResource CompareStringConverter}, ConverterParameter='Stupefied 1'}" Value="True">
                                <Setter TargetName="cStatusDisplay" Property="Visibility" Value="Visible" />
                                <Setter TargetName="cStupefied1Chance" Property="Visibility" Value="Visible" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Description, Converter={StaticResource CompareStringConverter}, ConverterParameter='Stupefied 2'}" Value="True">
                                <Setter TargetName="cStatusDisplay" Property="Visibility" Value="Visible" />
                                <Setter TargetName="cStupefied2Chance" Property="Visibility" Value="Visible" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Description, Converter={StaticResource CompareStringConverter}, ConverterParameter='Stupefied 3'}" Value="True">
                                <Setter TargetName="cStatusDisplay" Property="Visibility" Value="Visible" />
                                <Setter TargetName="cStupefied3Chance" Property="Visibility" Value="Visible" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Description, Converter={StaticResource CompareStringConverter}, ConverterParameter='Stupefied 4'}" Value="True">
                                <Setter TargetName="cStatusDisplay" Property="Visibility" Value="Visible" />
                                <Setter TargetName="cStupefied4Chance" Property="Visibility" Value="Visible" />
                            </DataTrigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>

                    <Style x:Key="StatusItemStyle" TargetType="ContentPresenter">
                        <Setter Property="Margin" Value="0,0"/>
                    </Style>

                    <System:Double x:Key="NumberMinusEighteen">-18</System:Double>
                </ControlTemplate.Resources>

                <Grid >
                    <Grid VerticalAlignment="Top" HorizontalAlignment="Left" x:Name="infoPanel" IsHitTestVisible="False">
                        <Grid.RenderTransform>
                            <TranslateTransform  X="{Binding CurrentPlayer.UIData.Cursor.Position.X}" Y="{Binding CurrentPlayer.UIData.Cursor.Position.Y}"/>
                        </Grid.RenderTransform>

                        <Grid x:Name="TaskInfoHolder" Margin="64,0,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.Tag>
                                <!--Calculate if HightDefense needs to be shown-->
                                <MultiBinding Converter="{StaticResource LessThanOrEqualMultiConverter}">
                                    <Binding Path="CurrentPlayer.CurrentTarget.Stats.ArmorClass.Value" Converter="{StaticResource AddConverter}" ConverterParameter="{StaticResource NumberMinusEighteen}"/>
                                    <Binding Path="CurrentPlayer.SelectedCharacter.Stats.Level.Value" Converter="{StaticResource DivideConverter}" ConverterParameter="{StaticResource DoubleTwoValue}"/>
                                </MultiBinding>
                            </Grid.Tag>
                            <!-- Task Icon -->
                            <Grid x:Name="TaskIcon" Grid.Column="0" Width="56" Height="56" VerticalAlignment="Top" HorizontalAlignment="Left" Visibility="Collapsed">
                                <Rectangle Fill="{Binding CurrentPlayer.SelectedCharacter.PlayerCharacterProperties.CurrentSpellTask.Icon}" Visibility="{Binding ElementName=taskObject,Path=Visibility,Converter={StaticResource InvertVisibilityConverter}}" Effect="{StaticResource DropShadow}"/>
                                <Rectangle x:Name="taskObject" Visibility="{Binding CurrentPlayer.UIData.ActiveTask.TaskObject,Converter={StaticResource NullToCollapsedConverter}}" Fill="{Binding CurrentPlayer.UIData.ActiveTask.TaskObject.Icon}"/>
                                <Rectangle x:Name="SpellDisabledOverlay" Visibility="{Binding CurrentPlayer.UIData.ActiveTask.CanExecute,Converter={StaticResource BoolToCollapsedConverter}}" Fill="#80000000"/>
                                <Rectangle x:Name="SpellLethalOverlay" Visibility="{Binding CurrentPlayer.UIData.ActiveTask.LethalOutcome,Converter={StaticResource BoolToVisibleConverter}}" Fill="#80FF0000"/>
                            </Grid>

                            <StackPanel Margin="12,0,0,0" Grid.Column="1" VerticalAlignment="Top" HorizontalAlignment="Left" DataContext="{Binding CurrentPlayer.UIData}" d:DataContext="{d:DesignInstance Type=ls:UIData}">
                                <b:Interaction.Behaviors>
                                    <ls:CapabilityListSelectorBehavior x:Name="CapabilityListSelectorBehavior"
                                                                       CapabilitiesCollection="{Binding DataContext.CurrentPlayer.SelectedCharacter.PlayerCharacterProperties.ModifiedCapabilities, ElementName=CursorText}"
                                                                       CharacterIsInTurnBasedMode="{Binding DataContext.CurrentPlayer.SelectedCharacter.InTurnBasedMode, ElementName=CursorText}"
                                                                       CharacterIsShapeshifted="{Binding DataContext.CurrentPlayer.SelectedCharacter.IsShapeShifted, ElementName=CursorText}"
                                                                       PlayerCurrentTaskType="{Binding DataContext.CurrentPlayer.UIData.ActiveTask.PreviewType, ElementName=CursorText}"/>
                                </b:Interaction.Behaviors>

                                <StackPanel Orientation="Horizontal">

                                    <!-- Multi-target Progress -->
                                    <Grid x:Name="CursorDashContainer" VerticalAlignment="Center" Visibility="Collapsed" Margin="-4,0,8,0" Height="{Binding ActualHeight, ElementName=TaskIcon}" Effect="{StaticResource DropShadow}">
                                        <Grid.Resources>
                                            <Style x:Key="CursorDashPathStyle" TargetType="Path">
                                                <Setter Property="StrokeThickness" Value="8"/>
                                                <Setter Property="noesis:Element.PPAAIn" Value="0.3"/>
                                                <Setter Property="noesis:Element.PPAAOut" Value="2.0"/>
                                                <Setter Property="RenderOptions.BitmapScalingMode" Value="NearestNeighbor"/>
                                                <Setter Property="UseLayoutRounding" Value="True"/>
                                                <Setter Property="SnapsToDevicePixels" Value="True"/>
                                                <Setter Property="Width" Value="50"/>
                                                <Setter Property="Height" Value="50"/>
                                                <Setter Property="Stroke" Value="{StaticResource LS_tint100}"/>
                                                <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                                                <Setter Property="Data">
                                                    <Setter.Value>
                                                        <EllipseGeometry RadiusX="20" RadiusY="20" Center="25,25"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>

                                            <Style x:Key="CursorHPDashPathStyle" TargetType="Path" BasedOn="{StaticResource CursorDashPathStyle}">
                                                <Setter Property="noesis:Element.PPAAIn" Value="0.25"/>
                                                <Setter Property="noesis:Element.PPAAOut" Value="0.25"/>
                                            </Style>

                                            <System:Double x:Key="BaseColorOpacity">0.65</System:Double>
                                            <SolidColorBrush x:Key="BaseColor" Color="{Binding Source={StaticResource LS_accent100TxtColor}, Path=Color}"/>
                                            <SolidColorBrush x:Key="HighlightColor" Color="{Binding Source={StaticResource LS_accent100TxtColor}, Path=Color}"/>
                                        </Grid.Resources>

                                        <Control x:Name="InnerHitPointsDash" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource SimplifiedCursorDashTemplate}" DataContext="{Binding ActiveTask.HPTargetValues}" Visibility="{Binding DataContext, RelativeSource={RelativeSource Self}, Converter={StaticResource NullToCollapsedConverter}}">
                                            <Control.Resources>
                                                <Style x:Key="PieStyle" BasedOn="{StaticResource CursorHPDashPathStyle}"/>
                                                <System:Double x:Key="RelativeSegmentLength">0.9</System:Double>
                                            </Control.Resources>
                                        </Control>

                                        <Control x:Name="InnerProjectilesDash" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource SimplifiedCursorDashTemplate}" DataContext="{Binding ActiveTask.TargetValues}" Visibility="{Binding DataContext, RelativeSource={RelativeSource Self}, Converter={StaticResource NullToCollapsedConverter}}">
                                            <Control.Resources>
                                                <Style x:Key="PieStyle" BasedOn="{StaticResource CursorDashPathStyle}"/>
                                                <System:Double x:Key="RelativeSegmentLength">0.9</System:Double>
                                            </Control.Resources>
                                        </Control>
                                    </Grid>

                                    <!-- Hit Chance -->
                                    <Border x:Name="hitChance" Height="{Binding ActualHeight, ElementName=TaskIcon}" Visibility="{Binding HitChanceDesc.ShowDescription, Converter={StaticResource BoolToVisibleConverter}}">
                                        <TextBlock x:Name="hitChanceText" VerticalAlignment="Center" Margin="0,2,0,0" Text="{Binding HitChanceDesc.TotalHitChance, StringFormat={}{0}%}" Style="{StaticResource CursorTextStyle}" FontSize="{StaticResource ScaledBigFontSize}" TextAlignment="Left"/>
                                    </Border>

                                    <!-- Distance -->
                                    <TextBlock x:Name="distance" Panel.ZIndex="9" Text="{Binding Cursor.Distance,Converter={StaticResource UnitConverter}, ConverterParameter='Distance N1 Short'}" Style="{StaticResource CursorTextStyle}" FontSize="{StaticResource ScaledBigFontSize}"  Visibility="{Binding Cursor.Distance,Converter={StaticResource CountToVisibilityConverter}}"/>

                                    <!-- Obscured Indicator -->
                                    <Image x:Name="ObscuredIndicator" Stretch="None" Visibility="Collapsed" HorizontalAlignment="Left"/>

                                    <!-- Encumberance -->
                                    <Grid HorizontalAlignment="Left" x:Name="EncumbranceIndicator" >
                                        <Image Source="pack://application:,,,/Core;component/Assets/Tooltips/weightInfo_BG.png" Stretch="None" ClipToBounds="False" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,-6,-20,0"/>
                                        <Control Template="{StaticResource EncumbranceStateWarningTemplate}" DataContext="{Binding Cursor.EncumbranceStateWarning}" VerticalAlignment="Center" Margin="60,0,0,0"/>
                                    </Grid>
                                </StackPanel>

                                <!-- Confirmation message -->
                                <TextBlock x:Name="ConfirmationText" Text="{Binding Source='h2ab6b090gae25g45a3gbd00g2cb47a85bff2',Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource CursorTextStyle}" Visibility="Collapsed"/>

                                <!-- Target Name and Surface/Cloud -->
                                <ls:LSNineSliceImage x:Name="TargetPanel" ImageSource="pack://application:,,,/Core;component/Assets/Tooltips/worldTT_context_bg.png" Slices="22" Visibility="Collapsed" HorizontalContentAlignment="Left" HorizontalAlignment="Left" Margin="-14,-14,0,0" Padding="32,22">
                                    <StackPanel HorizontalAlignment="Left" Orientation="Horizontal">
                                        <TextBlock x:Name="Target" Text="{Binding DataContext.CurrentPlayer.CurrentTarget.Name, RelativeSource={RelativeSource AncestorType=ls:UIWidget}}"
                                                   Style="{StaticResource CollapsedNameStyle}" Foreground="{StaticResource LS_tint100}"/>
                                        <TextBlock x:Name="TargetAmount" Text="{Binding DataContext.CurrentPlayer.CurrentTarget.Count, RelativeSource={RelativeSource AncestorType=ls:UIWidget}, StringFormat='({0})'}"
                                                   Style="{StaticResource CollapsedNameStyle}" Foreground="{StaticResource LS_tint100}" Margin="8,0,0,0" 
                                                   Visibility="Collapsed"/>
                                        <TextBlock x:Name="CloudInfo"  Text="{Binding CloudInformation.Header}" Style="{StaticResource CollapsedNameStyle}" Visibility="Collapsed"/>
                                        <TextBlock x:Name="SurfaceInfo" Text="{Binding SurfaceInformation.Header}" Style="{StaticResource CollapsedNameStyle}" Visibility="Collapsed"/>
                                    </StackPanel>
                                </ls:LSNineSliceImage>

                                <!-- Concealment -->
                                <StackPanel Orientation="Horizontal">
                                    <ItemsControl ItemsSource="{Binding HitChanceDesc.Advantages}" AlternationCount="{Binding HitChanceDesc.Advantages.Count}" ItemTemplate="{StaticResource StatusItemTemplate}" ItemContainerStyle="{StaticResource StatusItemStyle}" VerticalAlignment="Bottom">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                    </ItemsControl>
                                </StackPanel>

                                <!-- Advantage / Disadvantage -->
                                <StackPanel x:Name="AdvantagesList" Orientation="Horizontal" Visibility="{Binding HitChanceDesc.Advantages.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                    <Image Source="{StaticResource IconAdvantage}" Stretch="None" VerticalAlignment="Center" Effect="{StaticResource DropShadow}"/>
                                    <TextBlock Text="{Binding Source='h986f906agb172g4956g9567g5cbd32150349', Converter={StaticResource TranslatedStringConverter}, StringFormat='\ {0}'}" Style="{StaticResource CursorTextStyle}" FontSize="{StaticResource ScaledSmallishFontSize}" VerticalAlignment="Center" Margin="0,0"/>
                                </StackPanel>

                                <StackPanel x:Name="DisadvantagesList" Orientation="Horizontal" Visibility="{Binding HitChanceDesc.Disadvantages.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                    <Image Source="{StaticResource IconDisadvantage}" Stretch="None" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding Source='had6da506gedf2g4c86g9324g452e287e3c47', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource CursorTextStyle}" FontSize="{StaticResource ScaledSmallishFontSize}" VerticalAlignment="Center" Margin="0,0"/>
                                </StackPanel>

                                <!-- Relative Defense -->
                                <TextBlock x:Name="highDefText" Text="{Binding Source='hd135c195g1887g4ee4g85b8g586666685815', Converter={StaticResource TranslatedStringConverter}}" Visibility="Collapsed" Style="{StaticResource CursorTextStyle}" FontSize="{StaticResource ScaledSmallishFontSize}" VerticalAlignment="Center" />

                                <!-- IF: WIP Bonus Modifiers will need code support
                                <StackPanel x:Name="BonusModifier" Orientation="Horizontal" Visibility="Visible">
                                    <Image Source="{StaticResource DeltasPlus}" Stretch="None" VerticalAlignment="Center" Margin="-16,0,-4,0"/>
                                    <TextBlock Text="+2 Damage" Style="{StaticResource CursorTextStyle}" Foreground="{StaticResource TooltipColor.Bonus}" FontSize="{StaticResource ScaledSmallishFontSize}" VerticalAlignment="Center" Margin="0,0"/>
                                </StackPanel>

                                <StackPanel x:Name="NegativeModifier" Orientation="Horizontal" Visibility="Visible">
                                    <Image Source="{StaticResource DeltasMinus}" Stretch="None" VerticalAlignment="Center" Margin="-16,0,-4,0"/>
                                    <TextBlock Text="-2 Damage" Style="{StaticResource CursorTextStyle}" Foreground="{StaticResource TooltipColor.Alert}" FontSize="{StaticResource ScaledSmallishFontSize}" VerticalAlignment="Center" Margin="0,0"/>
                                </StackPanel> -->

                                <!-- Error Messages -->
                                <ItemsControl x:Name="CursorTextList" ItemsSource="{Binding ActiveTask.Info}" HorizontalAlignment="Left">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Vertical"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="ls:VMText">
                                            <StackPanel x:Name="cTextRoot" Orientation="Horizontal">
                                                <!--ls:TextBlockFormatter.SourceText-->
                                                <TextBlock x:Name="txt" ls:TextBlockFormatter.SourceText="{Binding Text}" Style="{StaticResource CursorErrorTextStyle}"/>
                                            </StackPanel>
                                            <DataTemplate.Triggers>
                                                <DataTrigger Binding="{Binding TextContext}" Value="HitChance">
                                                    <Setter TargetName="cTextRoot" Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </DataTemplate.Triggers>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <ItemsControl x:Name="CapabilitiesErrors" ItemsSource="{Binding DataContext.CurrentPlayer.SelectedCharacter.PlayerCharacterProperties.ModifiedCapabilities, ElementName=CursorText}"
                                              AlternationCount="{Binding ItemsSource.Count, RelativeSource={RelativeSource Self}}">
                                    <ItemsControl.ItemContainerStyle>
                                        <Style TargetType="ContentPresenter">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <!-- Show only the first one -->
                                                <DataTrigger Value="True">
                                                    <DataTrigger.Binding>
                                                        <MultiBinding Converter="{StaticResource EqualConverter}">
                                                            <Binding Path="."/>
                                                            <Binding Path="FirstVisibleElement" ElementName="CapabilityListSelectorBehavior"/>
                                                        </MultiBinding>
                                                    </DataTrigger.Binding>
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ItemsControl.ItemContainerStyle>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="{x:Type ls:VMCapabilityModifier}">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock x:Name="Message" Style="{StaticResource CursorErrorTextStyle}"/>
                                                <TextBlock x:Name="Cause" Style="{StaticResource CursorErrorTextStyle}" Visibility="{Binding Cause, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}">
                                                    <TextBlock.Text>
                                                        <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                                            <Binding Source="hb19f530dgfeb2g4d13g8d64ga8216f364f67"/>
                                                            <Binding Path="Cause"/>
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                            </StackPanel>

                                            <DataTemplate.Triggers>

                                                <DataTrigger Binding="{Binding Type}" Value="MovementBlocked">
                                                    <Setter TargetName="Message" Property="Text" Value="{Binding Source='h7760a99cg8a58g4555gb0f1g0e3e2b872f66', Converter={StaticResource TranslatedStringConverter}}"/>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Type}" Value="MovementModification">
                                                    <Setter TargetName="Message" Property="Text" Value="{Binding Source='h987efa83g0f3bg416dga3dfg7a588084af78', Converter={StaticResource TranslatedStringConverter}}"/>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Type}" Value="MovementMultiplier">
                                                    <Setter TargetName="Message" Property="Text" Value="{Binding Source='h987efa83g0f3bg416dga3dfg7a588084af78', Converter={StaticResource TranslatedStringConverter}}"/>
                                                </DataTrigger>

                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding="{Binding Type}" Value="MovementMultiplier"/>
                                                        <Condition Binding="{Binding Value}" Value="0.5"/>
                                                    </MultiDataTrigger.Conditions>
                                                    <Setter TargetName="Message" Property="Text" Value="{Binding Source='h709568ceg6653g4caag90afg57b5be47ca55', Converter={StaticResource TranslatedStringConverter}}"/>
                                                </MultiDataTrigger>

                                                <DataTrigger Binding="{Binding Type}" Value="MovementCostMultiplier">
                                                    <Setter TargetName="Message" Property="Text" Value="{Binding Source='hd5796d9fg7f28g4f61g9287g688eccd1b538', Converter={StaticResource TranslatedStringConverter}}"/>
                                                </DataTrigger>
                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding="{Binding Type}" Value="MovementCostMultiplier"/>
                                                        <Condition Binding="{Binding Value}" Value="2"/>
                                                    </MultiDataTrigger.Conditions>
                                                    <Setter TargetName="Message" Property="Text" Value="{Binding Source='hb8b5ca34g224eg4ed0g8029g170746bef0f4', Converter={StaticResource TranslatedStringConverter}}"/>
                                                </MultiDataTrigger>

                                                <DataTrigger Binding="{Binding Visibility, ElementName=Message}" Value="Collapsed">
                                                    <Setter TargetName="Cause" Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>

                                            </DataTemplate.Triggers>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- Active Concentration Warning -->
                                <TextBlock x:Name="ConcentrationWarningText" 
                                            Style="{StaticResource CursorTextStyle}" 
                                            Foreground="{StaticResource LS_warning100TxtColor}"
                                            FontSize="{StaticResource ScaledSmallishFontSize}" 
                                            VerticalAlignment="Center" TextWrapping="Wrap"
                                            Visibility="Collapsed">
                                    <TextBlock.Text>
                                        <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                            <Binding Source="h0604f01ag5d1eg4f62g8dcbg8cad97adbc59"/>
                                            <Binding Path="DataContext.CurrentPlayer.SelectedCharacter.ConcentrationSpell.Name" ElementName="CursorText"/>
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>

                                <!-- Move preview receives an attack (attack of opportunity) -->
                                <TextBlock
                                    Text="{Binding Source='ha622b8f7gecf0g44c8gb8abgca896b1c48ef', Converter={StaticResource TranslatedStringConverter}}"
                                    Visibility="{Binding ActiveTask.AoOWarning, Converter={StaticResource BoolToVisibleConverter}, FallbackValue=Collapsed}"
                                    Style="{StaticResource CursorTextStyle}"
                                    Foreground="{StaticResource LS_warning100TxtColor}"
                                    FontSize="{StaticResource ScaledSmallishFontSize}"
                                    VerticalAlignment="Center"/>

                                <!-- Move preview goes over a surface -->
                                <TextBlock
                                    Text="{Binding ActiveTask.SurfaceMessage}"
                                    Visibility="{Binding ActiveTask.SurfaceMessage, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}"
                                    Style="{StaticResource CursorTextStyle}"
                                    FontSize="{StaticResource ScaledSmallishFontSize}"
                                    VerticalAlignment="Center"/>

                                <StackPanel x:Name="TargetCantBeHealedError" Orientation="Horizontal" Visibility="{Binding DataContext.CurrentPlayer.UIData.ActiveTask.TargetCanBeHealed, ElementName=CursorText, Converter={StaticResource BoolToCollapsedConverter}}" >
                                    <TextBlock x:Name="Message" Style="{StaticResource CursorErrorTextStyle}" Text="{Binding Source='h392eef12g97b6g47c8g858egd305c12f7dfd', Converter={StaticResource TranslatedStringConverter}}"/>
                                    <TextBlock x:Name="Cause" Style="{StaticResource CursorErrorTextStyle}" Visibility="{Binding DataContext.CurrentPlayer.UIData.ActiveTask.TargetHealBlockCause, ElementName=CursorText, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}">
                                        <TextBlock.Text>
                                            <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                                <Binding Source="hb19f530dgfeb2g4d13g8d64ga8216f364f67"/>
                                                <Binding Path="DataContext.CurrentPlayer.UIData.ActiveTask.TargetHealBlockCause" ElementName="CursorText"/>
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Grid>

                    <!-- Pinned Tooltips -->
                    <ls:LSInputBinding x:Name="ExamineInput"
                        BoundEvent="UIPinTooltip"
                        IsEnabled="{Binding CurrentPlayer.CurrentTarget.IsExaminable, FallbackValue=False}"
                        Command="{Binding ExamineCommand}"
                        CommandParameter="{Binding CurrentPlayer.CurrentRegularOrCombatTurnTarget.EntityHandle}"/>

                    <ls:LSInputBinding x:Name="PinInput"
                        BoundEvent="UIPinTooltip"
                        IsEnabled="{Binding ElementName=TargetPanel, Path=IsVisible}"
                        Command="{Binding PinCursorDataCommand.ActionCommand}">
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="LSInputBindingPressed">
                                <b:ChangePropertyAction TargetName="TTTransform" PropertyName="X" Value="{Binding CurrentPlayer.UIData.Cursor.Position.X}"/>
                                <b:ChangePropertyAction TargetName="TTTransform" PropertyName="Y" Value="{Binding CurrentPlayer.UIData.Cursor.Position.Y}"/>
                                <b:ChangePropertyAction TargetName="infoPanel" PropertyName="Visibility" Value="Collapsed"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </ls:LSInputBinding>

                    <Grid x:Name="ExtendedInfo" Visibility="Collapsed" ls:TooltipExtender.Owner="{Binding CurrentPlayer.SelectedCharacter}" ls:TooltipExtender.Context="World">
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="MouseRightButtonDown">
                                <b:ChangePropertyAction TargetName="infoPanel" PropertyName="Visibility" Value="Visible"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                        <ls:LSButton BoundEvent="UIPinTooltip" Background="#BB000000">
                            <b:Interaction.Triggers>
                                <b:EventTrigger EventName="Click">
                                    <b:ChangePropertyAction TargetName="infoPanel" PropertyName="Visibility" Value="Visible"/>
                                    <b:InvokeCommandAction Command="{Binding ReleaseCursorDataCommand.ActionCommand}"/>
                                </b:EventTrigger>
                            </b:Interaction.Triggers>
                            <ls:LSButton.Template>
                                <ControlTemplate TargetType="ls:LSButton">
                                    <Rectangle Fill="{TemplateBinding Background}" />
                                </ControlTemplate>
                            </ls:LSButton.Template>
                        </ls:LSButton>
                        <StackPanel  x:Name="ttHolder" HorizontalAlignment="Left" VerticalAlignment="Top" Orientation="Horizontal" Margin="80,0,0,0" >
                            <StackPanel.RenderTransform>
                                <TransformGroup>
                                    <TranslateTransform x:Name="TTTransform" X="0" Y="0"/>
                                    <TranslateTransform x:Name="TTOffset" X="{Binding ElementName=SurfaceTTList,Path=ActualWidth,Converter={StaticResource MultiplierConverter}, ConverterParameter={StaticResource DoubleMinusOneValue}}" Y="0"/>
                                </TransformGroup>
                            </StackPanel.RenderTransform>
                            <b:Interaction.Behaviors>
                                <ls:KeepInsideParentBehavior Parent="{Binding ElementName=ExtendedInfo}"/>
                            </b:Interaction.Behaviors>
                            <StackPanel x:Name="SurfaceTTList" Orientation="Vertical" Margin="0">
                                <!-- Cloud information tooltip part -->
                                <ContentControl Template="{StaticResource NoPinTooltipTemplate}" Content="{Binding Cloud}" ContentTemplate="{StaticResource SurfaceTooltipContentTemplate}" HorizontalAlignment="Left" Width="{StaticResource SurfaceTooltipContentWidth}" MinHeight="{StaticResource SurfaceTooltipMinHeight}" Visibility="{Binding Cloud.HasSurface, Converter={StaticResource BoolToVisibleConverter}}" Margin="{StaticResource TooltipMargin}"/>
                                <ContentControl Template="{StaticResource NoPinTooltipTemplate}" Content="{Binding Surface}" ContentTemplate="{StaticResource SurfaceTooltipContentTemplate}" HorizontalAlignment="Left" Width="{StaticResource SurfaceTooltipContentWidth}" MinHeight="{StaticResource SurfaceTooltipMinHeight}" Visibility="{Binding Surface.HasSurface, Converter={StaticResource BoolToVisibleConverter}}" Margin="{StaticResource TooltipMargin}"/>
                            </StackPanel>
                            <ContentControl x:Name="worldTargetTT" Template="{StaticResource NoPinTooltipTemplate}" ls:TooltipExtender.Content="{Binding CurrentTarget}" Content="{Binding CurrentTarget}" ContentTemplate="{StaticResource CharacterTooltipTemplate}" HorizontalAlignment="Left" HorizontalContentAlignment="Left" Visibility="{Binding CurrentTarget, Converter={StaticResource NullToCollapsedConverter}}" Margin="{StaticResource TooltipMargin}" ls:TooltipExtender.IsOpen="{Binding IsVisible , RelativeSource={RelativeSource Self}}"/>
                        </StackPanel>

                    </Grid>
                </Grid>

                <ControlTemplate.Triggers>

                    <!--Show hover tooltip item amount only when the target is an item and there's more than one of it-->
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding CurrentPlayer.CurrentTarget.Type}" Value="Item"/>
                            <Condition Binding="{Binding CurrentPlayer.CurrentTarget.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter=1}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="TargetAmount" Property="Visibility" Value="Visible"/>
                    </MultiDataTrigger>

                    <DataTrigger Binding="{Binding Cloud.HasSurface}" Value="True">
                        <Setter TargetName="ExtendedInfo" Property="Visibility" Value="Visible"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Surface.HasSurface}" Value="True">
                        <Setter TargetName="ExtendedInfo" Property="Visibility" Value="Visible"/>
                    </DataTrigger>

                    <!--Change the hover tooltip text color depending on rarity-->
                    <DataTrigger Binding="{Binding CurrentPlayer.CurrentTarget.Rarity}" Value="Uncommon">
                        <Setter TargetName="Target" Property="Foreground" Value="{StaticResource ItemRarityColour.Uncommon}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding CurrentPlayer.CurrentTarget.Rarity}" Value="Rare">
                        <Setter TargetName="Target" Property="Foreground" Value="{StaticResource ItemRarityColour.Rare}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding CurrentPlayer.CurrentTarget.Rarity}" Value="VeryRare">
                        <Setter TargetName="Target" Property="Foreground" Value="{StaticResource ItemRarityColour.VeryRare}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding CurrentPlayer.CurrentTarget.Rarity}" Value="Legendary">
                        <Setter TargetName="Target" Property="Foreground" Value="{StaticResource ItemRarityColour.Legendary}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding CurrentPlayer.CurrentTarget.IsStoryItem}" Value="True">
                        <Setter TargetName="Target" Property="Foreground" Value="{StaticResource LS_storyColor}"/>
                    </DataTrigger>

                    <!-- Triggers: TaskIcon-->

                    <DataTrigger Binding="{Binding CurrentPlayer.SelectedCharacter.PlayerCharacterProperties.CurrentSpellTask,Converter={StaticResource NullToBoolFalseConverter}}" Value="True">
                        <Setter TargetName="TaskIcon" Property="Visibility" Value="Visible"/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding CurrentPlayer.UIData.ActiveTask.TaskObject,Converter={StaticResource NullToBoolFalseConverter}}" Value="True">
                        <Setter TargetName="TaskIcon" Property="Visibility" Value="Visible"/>
                    </DataTrigger>

                    <!-- Triggers: Projectiles and HP -->
                    <DataTrigger Binding="{Binding Visibility, ElementName=InnerHitPointsDash}" Value="Visible">
                        <Setter TargetName="InnerProjectilesDash" Property="Visibility" Value="Collapsed"/>
                    </DataTrigger>

                    <!-- Triggers: HitChance and Primary messaging -->

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding CurrentPlayer.UIData.HitChanceDesc.Advantages.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter={StaticResource DoubleZeroValue}}" Value="True"/>
                            <Condition Binding="{Binding CurrentPlayer.UIData.HitChanceDesc.Disadvantages.Count}" Value="0"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="hitChanceText" Property="Foreground" Value="{StaticResource LS_bonusTxtColor}"/>
                    </MultiDataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding CurrentPlayer.UIData.HitChanceDesc.Advantages.Count}" Value="0"/>
                            <Condition Binding="{Binding CurrentPlayer.UIData.HitChanceDesc.Disadvantages.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter={StaticResource DoubleZeroValue}}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="hitChanceText" Property="Foreground" Value="{StaticResource LS_alertTxtColor}"/>
                    </MultiDataTrigger>

                    <DataTrigger Binding="{Binding Visibility, ElementName=InnerHitPointsDash}" Value="Visible">
                        <Setter TargetName="CursorDashContainer" Property="Visibility" Value="Visible" />
                    </DataTrigger>

                    <DataTrigger Binding="{Binding Visibility, ElementName=InnerProjectilesDash}" Value="Visible">
                        <Setter TargetName="CursorDashContainer" Property="Visibility" Value="Visible" />
                    </DataTrigger>

                    <DataTrigger Binding="{Binding CurrentPlayer.UIData.Cursor.CursorObscuredState}" Value="Clear">
                        <Setter TargetName="ObscuredIndicator" Property="Visibility" Value="Visible"/>
                        <Setter TargetName="ObscuredIndicator" Property="Source" Value="pack://application:,,,/Core;component/Assets/HUD/ico_fullSun.png"/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding CurrentPlayer.UIData.Cursor.CursorObscuredState}" Value="LightlyObscured">
                        <Setter TargetName="ObscuredIndicator" Property="Visibility" Value="Visible"/>
                        <Setter TargetName="ObscuredIndicator" Property="Source" Value="pack://application:,,,/Core;component/Assets/HUD/ico_halfSun.png"/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding CurrentPlayer.UIData.Cursor.CursorObscuredState}" Value="HeavilyObscured">
                        <Setter TargetName="ObscuredIndicator" Property="Visibility" Value="Visible"/>
                        <Setter TargetName="ObscuredIndicator" Property="Source" Value="pack://application:,,,/Core;component/Assets/HUD/ico_hollowSun.png"/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding CurrentPlayer.UIData.ActiveTask.RootCastSpell.SpellType}" Value="Shout">
                        <Setter TargetName="ConfirmationText" Property="Visibility" Value="Visible"/>
                    </DataTrigger>

                    <!-- Tirggers: TargetPanel -->

                    <DataTrigger Binding="{Binding CurrentTarget, Converter={StaticResource TypeConverter}}" Value="ls.VMItem">
                        <Setter TargetName="worldTargetTT" Property="ContentTemplate" Value="{StaticResource ItemsTooltip}"/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding CurrentPlayer.UIData.Cursor.EncumbranceStateWarning }" Value="None">
                        <Setter TargetName="EncumbranceIndicator" Property="Visibility" Value="Collapsed"/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding CurrentPlayer.CurrentTarget,Converter={StaticResource NullToBoolFalseConverter}}" Value="True">
                        <Setter TargetName="TargetPanel" Property="Visibility" Value="Visible"/>
                    </DataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding CurrentPlayer.CurrentTarget,Converter={StaticResource NullToBoolFalseConverter}}" Value="False"/>
                            <Condition Binding="{Binding CurrentPlayer.UIData.CloudInformation.HasSurface}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="TargetPanel" Property="Visibility" Value="Visible"/>
                        <Setter TargetName="CloudInfo" Property="Visibility" Value="Visible"/>
                    </MultiDataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding CurrentPlayer.CurrentTarget,Converter={StaticResource NullToBoolFalseConverter}}" Value="False"/>
                            <Condition Binding="{Binding CurrentPlayer.UIData.SurfaceInformation.HasSurface}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="TargetPanel" Property="Visibility" Value="Visible"/>
                        <Setter TargetName="SurfaceInfo" Property="Visibility" Value="Visible"/>
                    </MultiDataTrigger>

                    <DataTrigger Binding="{Binding CurrentPlayer.SelectedCharacter.PlayerCharacterProperties.CurrentSpellTask,Converter={StaticResource NullToBoolFalseConverter}}" Value="True">
                        <Setter TargetName="TargetPanel" Property="Visibility" Value="Collapsed"/>
                    </DataTrigger>

                    <Trigger SourceName="CloudInfo" Property="Visibility" Value="Visible">
                        <Setter TargetName="Target" Property="Margin" Value="0,0,0,10"/>
                    </Trigger>

                    <Trigger SourceName="SurfaceInfo" Property="Visibility" Value="Visible">
                        <Setter TargetName="Target" Property="Margin" Value="0,0,0,10"/>
                    </Trigger>

                    <DataTrigger Binding="{Binding ElementName=worldTargetTT,Path=IsVisible}" Value="False">
                        <Setter TargetName="SurfaceTTList" Property="Margin" >
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource CreateRectConverter}">
                                    <Binding Path="ActualWidth" ElementName="SurfaceTTList"/>
                                    <Binding Source="0"/>
                                    <Binding Source="0"/>
                                    <Binding Source="0"/>
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                    </DataTrigger>

                    <!-- Triggers: Extra messaging -->

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding CurrentPlayer.UIData.HitChanceDesc.Advantages.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter={StaticResource DoubleZeroValue}}" Value="True"/>
                            <Condition Binding="{Binding CurrentPlayer.UIData.HitChanceDesc.Disadvantages.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter={StaticResource DoubleZeroValue}}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="AdvantagesList" Property="Visibility" Value="Collapsed"/>
                        <Setter TargetName="DisadvantagesList" Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding CurrentPlayer.UIData.HitChanceDesc.ShowDescription}" Value="True"/>
                            <Condition Binding="{Binding ElementName=TaskInfoHolder,Path=Tag}" Value="False"/>
                            <Condition Binding="{Binding CurrentPlayer.CurrentRegularOrCombatTurnTarget.PlayerRelation}" Value="Enemy"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="highDefText" Property="Visibility" Value="Visible"/>
                    </MultiDataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding CurrentPlayer.UIData.Cursor.IsOverUI}" Value="True"/>
                            <Condition Binding="{Binding CurrentPlayer.UIData.Cursor.TargetInUI}" Value="False"/>
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter TargetName="CursorTextList" Property="Visibility" Value="Collapsed" />
                            <Setter TargetName="CapabilitiesErrors" Property="Visibility" Value="Collapsed" />
                            <Setter TargetName="TargetCantBeHealedError" Property="Visibility" Value="Collapsed" />
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding CurrentPlayer.SelectedCharacter.IsCurrentTurn}" Value="False"/>
                            <Condition Binding="{Binding CurrentPlayer.CanEndTurn}" Value="False"/>
                            <Condition Binding="{Binding CurrentPlayer.SelectedCharacter.CharacterMode}" Value="InFTB"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="CapabilitiesErrors" Property="Visibility" Value="Collapsed" />
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding CurrentPlayer.SelectedCharacter.IsCurrentTurn}" Value="False"/>
                            <Condition Binding="{Binding CurrentPlayer.CanEndTurn}" Value="False"/>
                            <Condition Binding="{Binding CurrentPlayer.SelectedCharacter.CharacterMode}" Value="InCombat"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="CapabilitiesErrors" Property="Visibility" Value="Collapsed" />
                    </MultiDataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding CurrentPlayer.SelectedCharacter.PlayerCharacterProperties.CurrentSpellTask.IsConcentrationSpell}" Value="True"/>
                            <Condition Binding="{Binding CurrentPlayer.SelectedCharacter.ConcentrationSpell, Converter={StaticResource NullToBoolFalseConverter}}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="ConcentrationWarningText" Property="Visibility" Value="Visible" />
                    </MultiDataTrigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Control.Template>
    </Control>
</ls:UIWidget>